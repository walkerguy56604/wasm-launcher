<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WASM Data Receiver</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    margin: 1em;
    background: #121212;
    color: #eee;
  }
  pre {
    background: #222;
    padding: 1em;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 1rem;
  }
  .key { color: #9cdcfe; }
  .string { color: #ce9178; }
  .number { color: #b5cea8; }
  .boolean { color: #569cd6; }
  .null { color: #808080; }
</style>
</head>
<body>
<h1>WASM Data Receiver</h1>
<pre id="jsonDisplay">Waiting for data...</pre>
<script>
function syntaxHighlight(json) {
  if (typeof json != 'string') {
    json = JSON.stringify(json, undefined, 2);
  }
  json = json
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
  return json.replace(
    /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
    function (match) {
      let cls = 'number';
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'key';
        } else {
          cls = 'string';
        }
      } else if (/true|false/.test(match)) {
        cls = 'boolean';
      } else if (/null/.test(match)) {
        cls = 'null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    }
  );
}
function getParameterByName(name) {
  const url = window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
  const results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

const dataParam = getParameterByName('data');
const jsonDisplay = document.getElementById('jsonDisplay');

if (dataParam) {
  try {
    const jsonData = JSON.parse(dataParam);
    jsonDisplay.innerHTML = syntaxHighlight(jsonData);
  } catch (e) {
    jsonDisplay.textContent = 'Error parsing JSON data.';
  }
} else {
  jsonDisplay.textContent = 'No data received.';
}
</script>
</body>
</html>
